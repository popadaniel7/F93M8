#include "Bsw_Wrapper.h"
#include "SysMgr.h"
#include "Wdg.h"
#include "IfxCpu.h"
#include "IfxStm.h"
#include "task.h"
#include "FreeRTOSConfig.h"
#include "ComMaster.h"
#include "Iven.h"
#include "DcyHandler.h"
#include "ColDet.h"
#include "EnergyMgmt.h"
#include "DiagMaster.h"

static uint32 Bsw_Wrapper_MainCounter_C0 = 0u;

void Bsw_Wrapper_MainFunction_C0(void);
void Bsw_Wrapper_MainFunction_C1(void);
void Bsw_Wrapper_MainFunction_C2(void);

void Bsw_Wrapper_MainFunction_C0(void)
{
    static uint8 pEnergyMgmt_CanTx_PowerSupplyReducedPerformance = 0u;

    memcpy(ComMaster_ReceiveTable, Can_ReceiveTable, 9u);

    ComMaster_TxSignal_ICM_ID = Iven_CanTx_IcmId;
    ComMaster_TxSignal_IrSenStat = ColDet_CanTx_IrSenStat;
    ComMaster_TxSignal_Rpm = 0u;
    ComMaster_TxSignal_Speed = 0u;
    ComMaster_TxSignal_VehicleStatus = DcyHandler_CanTx_VehicleState;
    DcyHandler_CanRx_IgnitionState = Iven_CanTx_InVehicleSafetyError;
    ComMaster_TxSignal_DcyStatus = DcyHandler_CanTx_DcyStatus;
    DcyHandler_CanRx_VehicleSpeed = ComMaster_TxSignal_Speed;
    DcyHandler_CanRx_GearboxState = ComMaster_TxSignal_Gear;
    DcyHandler_CanRx_IgnitionState = ComMaster_TxSignal_Ignition;
    DiagMaster_GearboxStatus = DcyHandler_CanRx_GearboxState;
    DiagMaster_VehicleSpeed = ComMaster_TxSignal_Speed;
    ColDet_CalculatedSpeed = ComMaster_TxSignal_Speed;
    EnergyMgmt_CanRx_LoadStatus1 = ComMaster_RxSignal_LoadStatus1;
    EnergyMgmt_CanRx_LoadStatus2 = ComMaster_RxSignal_LoadStatus2;
    EnergyMgmt_CanRx_LoadStatus3 = ComMaster_RxSignal_LoadStatus3;
    EnergyMgmt_CanRx_LoadStatus4 = ComMaster_RxSignal_LoadStatus4;
    EnergyMgmt_CanRx_LoadStatus5 = ComMaster_RxSignal_LoadStatus5;
    EnergyMgmt_CanRx_LoadStatus6 = ComMaster_RxSignal_LoadStatus6;
    EnergyMgmt_CanRx_LoadStatus7 = ComMaster_RxSignal_LoadStatus7;
    EnergyMgmt_CanRx_LoadStatus8 = ComMaster_RxSignal_LoadStatus8;
    EnergyMgmt_CanRx_IgnitionStatus = ComMaster_TxSignal_Ignition;
    EnergyMgmt_CanTx_VehicleState = DcyHandler_CanTx_VehicleState;
    EnergyMgmt_CanRx_StatusDoorLeft = ComMaster_RxSignal_StatusDoorLeft;
    EnergyMgmt_CanRx_StatusDoorRight = ComMaster_RxSignal_StatusDoorRight;
    EnergyMgmt_CanRx_StatusHc05 = ComMaster_RxSignal_StatusHc05;
    EnergyMgmt_CanRx_VoltageMeasured = ComMaster_TxSignal_VBat;
    EnergyMgmt_CanRx_CurrentMeasured = ComMaster_RxSignal_TotalCurrentConsumption;
    EnergyMgmt_CanRx_CurrentMeasured2 = ComMaster_RxSignal_TotalCurrentConsumption2;

    if((0u != EnergyMgmt_CanTx_PowerSupplyReducedPerformance) &&
            (pEnergyMgmt_CanTx_PowerSupplyReducedPerformance != EnergyMgmt_CanTx_PowerSupplyReducedPerformance))
    {
        Iven_IcmLookupTable[15u].messageStatus = 1u;
    }
    else
    {
        /* Do nothing. */
    }

    Iven_CanRx_ErrorDetectedCbm = ComMaster_RxSignal_Err701_ID;
    Iven_CanRx_ErrorDetectedPdm = ComMaster_RxSignal_Err705_ID;
    Iven_CanTx_IrSenStat = ColDet_CanTx_IrSenStat;
    Iven_CanRx_PowerSteeringControl = ComMaster_TxSignal_PowerSteeringAngle;
    Iven_CanRx_GearboxControl = ComMaster_TxSignal_Gear;
    Iven_CanRx_AccelerationControl = ComMaster_RxSignal_StatusAcc;
    Iven_CanRx_BrakeControl = ComMaster_RxSignal_StatusBr;
    Iven_CanRx_IgnitionControl = ComMaster_TxSignal_Ignition;
    Iven_CanRx_StatusDoorLeft = ComMaster_RxSignal_StatusDoorLeft;
    Iven_CanRx_StatusDoorRight = ComMaster_RxSignal_StatusDoorRight;
    Iven_CanRx_PSNWarn = ComMaster_RxSignal_PSNWarn;
    Iven_CanRx_CurrentConsumption  = ComMaster_RxSignal_TotalCurrentConsumption;
    Iven_CanRx_CurrentConsumption2 = ComMaster_RxSignal_TotalCurrentConsumption2;
    Iven_StatusDriveControlMessageState = 0u;
    Iven_StatusLoadListMessageState = 0u;
    Iven_StatusPowerSupplyNetworkMessageState = 0u;
    Iven_CanTx_DecMcuError = 0u;
    Iven_CanTx_PowerSteeringFanStatus = 0u;
    Iven_CanTx_EMotorStatus = 0u;
    Iven_CanTx_SpeedSensorStatus = 0u;
    Iven_CanTx_TempSenPSteering = 0u;
    Iven_CanTx_PowerSteeringStatus = 0u;
    Iven_StatusActuatorMessageState = 0u;
    Iven_CanTx_DiagnosticMode = DiagMaster_DiagnosticModeActivated;
    DcyHandler_CanRx_RequestDiagnosisMode = DiagMaster_DiagnosticModeActivated;
    DcyHandler_CanRx_ResetDcy = DiagMaster_ResetDcy;

    Wdg_ReloadCpu0Watchdog();
    Wdg_ReloadSafetyWatchdog();
}
void Bsw_Wrapper_MainFunction_C1(void)
{
    Wdg_ReloadCpu1Watchdog();

    if(SYSMGR_SLEEP == SysMgr_EcuState)
    {
        Wdg_DeInitializeCpu1Watchdog();
        vTaskSuspendAll();
        vTaskEndScheduler();
        IfxStm_disableModule(&MODULE_STM1);
        SysMgr_Core1OnHalt = 1u;
        IfxCpu_setCoreMode(&MODULE_CPU1, IfxCpu_CoreMode_idle);
    }
    else
    {
        /* Do nothing. */
    }
}
void Bsw_Wrapper_MainFunction_C2(void)
{
    Wdg_ReloadCpu2Watchdog();

    if(SYSMGR_SLEEP == SysMgr_EcuState)
    {
        Wdg_DeInitializeCpu1Watchdog();
        vTaskSuspendAll();
        vTaskEndScheduler();
        IfxStm_disableModule(&MODULE_STM2);
        SysMgr_Core2OnHalt = 1u;
        IfxCpu_setCoreMode(&MODULE_CPU2, IfxCpu_CoreMode_idle);
    }
    else
    {
        /* Do nothing. */
    }
}
